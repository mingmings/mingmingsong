<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/note/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/note/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/note/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/note/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/note/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/note/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/note/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="MySQL 错误集合," />










<meta name="description" content="此篇专门用来记录 MySQL 各方面出现的一些错误以及解决方法等">
<meta name="keywords" content="MySQL 错误集合">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL 错误集锦">
<meta property="og:url" content="http://mingmings.org/note/db_MySQL-错误集锦.html">
<meta property="og:site_name" content="异类深呼吸">
<meta property="og:description" content="此篇专门用来记录 MySQL 各方面出现的一些错误以及解决方法等">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2017-04-22T15:48:06.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="MySQL 错误集锦">
<meta name="twitter:description" content="此篇专门用来记录 MySQL 各方面出现的一些错误以及解决方法等">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/note/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://mingmings.org/note/db_MySQL-错误集锦.html"/>





  <title>MySQL 错误集锦 | 异类深呼吸</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/note/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">异类深呼吸</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description"></h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/note/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/note/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/note/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/note/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="st-search-show-outputs">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <form class="site-search-form">
  <input type="text" id="st-search-input" class="st-search-input st-default-search-input" />
</form>

<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
    (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
    e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install', '2XUreAeRFh7MepgoTDCi','2.0.0');
</script>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://mingmings.org/note/note/db_MySQL-错误集锦.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="宋大明明">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/note/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="异类深呼吸">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">MySQL 错误集锦</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-03-26T17:16:41+08:00">
                2015-03-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/note/categories/DB/" itemprop="url" rel="index">
                    <span itemprop="name">DB</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-comment-o"></i>
              </span>
              
                <a href="/note/db_MySQL-错误集锦.html#SOHUCS" itemprop="discussionUrl">
                  <span id="changyan_count_unit" class="post-comments-count hc-comment-count" data-xid="db_MySQL-错误集锦.html" itemprop="commentsCount"></span>
                </a>
              
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>此篇专门用来记录 <code>MySQL</code> 各方面出现的一些错误以及解决方法等<br><a id="more"></a></p>
<h2 id="一、安装错误"><a href="#一、安装错误" class="headerlink" title="一、安装错误"></a>一、安装错误</h2><h4 id="1-1、初始化库错误提示"><a href="#1-1、初始化库错误提示" class="headerlink" title="1.1、初始化库错误提示"></a>1.1、初始化库错误提示</h4><figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line"><span class="comment"># /usr/local/mysql/scripts/mysql_install_db --user=mysql --datadir=/data/mysql3307/</span></span><br><span class="line"></span><br><span class="line">FATAL ERROR: Could <span class="keyword">not</span> find ./bin/my_print_defaults</span><br><span class="line"></span><br><span class="line">If you compiled <span class="built_in">from</span> source, you need <span class="built_in">to</span> run <span class="string">'make install'</span> <span class="built_in">to</span></span><br><span class="line">copy <span class="keyword">the</span> software <span class="keyword">into</span> <span class="keyword">the</span> correct location ready <span class="keyword">for</span> operation.</span><br><span class="line"></span><br><span class="line">If you are <span class="keyword">using</span> <span class="keyword">a</span> binary release, you must either be <span class="keyword">at</span> <span class="keyword">the</span> top</span><br><span class="line">level <span class="keyword">of</span> <span class="keyword">the</span> extracted archive, <span class="keyword">or</span> pass <span class="keyword">the</span> <span class="comment">--basedir option</span></span><br><span class="line">pointing <span class="built_in">to</span> that location.</span><br></pre></td></tr></table></figure>
<p>严格来说这不算是个错误，只是提示路径不对，或者加上基准路径的参数<br>第一种解决方法就是移动到 <code>cd ${INSTALL_DIR}</code> 再次执行这个命令即可正确初始化库了</p>
<p>第二种解决方法直接加上基准路径，这里假如我安装的位置是 <code>/usr/local/bin</code></p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"># <span class="regexp">/usr/</span>local<span class="regexp">/mysql/</span>scripts<span class="regexp">/mysql_install_db --user=mysql --basedir=/u</span>sr<span class="regexp">/local/</span>bin --datadir=<span class="regexp">/data/my</span>sql3307<span class="regexp">/</span></span><br></pre></td></tr></table></figure>
<h4 id="1-2、初始化库错误提示"><a href="#1-2、初始化库错误提示" class="headerlink" title="1.2、初始化库错误提示"></a>1.2、初始化库错误提示</h4><blockquote>
<p>看到有人提到 <code>MySQL</code> 官方的 bug 里，详情见 <a href="https://bugs.mysql.com/bug.php?id=31312" target="_blank" rel="noopener">Bug #31312</a></p>
</blockquote>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 启动报错</span></span><br><span class="line">~<span class="string">/bin/mysqld_safe</span> <span class="params">--user=mysql</span> <span class="params">--ledir=/tools/mysql/mysql</span> <span class="params">--defaults-file=/etc/mysql/mysql3307</span>.cnf &amp;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看错误日志看到如下信息</span></span><br><span class="line">[ERROR] ~<span class="string">/mysql/bin/mysqld</span>: unknown variable 'defaults-file=<span class="string">/etc/mysql/mysql3307.cnf</span>'</span><br><span class="line">[ERROR] Aborting</span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据 bug 文档里内容更换参数位置重新启动即可</span></span><br><span class="line">~<span class="string">/bin/mysqld_safe</span> <span class="params">--defaults-file=/etc/mysql/mysql3307</span>.cnf <span class="params">--user=mysql</span> <span class="params">--ledir=/tools/mysql/mysql/bin</span>  &amp;</span><br></pre></td></tr></table></figure>
<h4 id="1-3、mysql-sock-文件查找不到的情况"><a href="#1-3、mysql-sock-文件查找不到的情况" class="headerlink" title="1.3、mysql.sock 文件查找不到的情况"></a>1.3、mysql.sock 文件查找不到的情况</h4><figure class="highlight subunit"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ERROR </span>2002 (HY000): Can't connect to local MySQL server through socket '/tmp/mysql.sock' (2)</span><br></pre></td></tr></table></figure>
<p>这里我碰到过的就有好几种情况会碰到找不到 sock 文件的，分别列举</p>
<p>1.最近一次是因为做了单机多实例的关系，所以修改了原先的 3306 的 sock 文件名称，重启服务后必须 <code>-S sockfile</code> 来指定文件启动，如果不指定，就会报这个错误，但其实这也不是个错误，要么指定一下，要么直接做个软链接即可</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 解决方法</span></span><br><span class="line">ln -s <span class="regexp">/tmp/my</span>sql3306.sock <span class="regexp">/tmp/my</span>sql.sock</span><br></pre></td></tr></table></figure>
<p>2.第二种是真的 sock 文件丢失的情况，这时候查看 mysql 进程也基本上不存在</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 解决方法，通过安全模式启动</span></span><br><span class="line">mysqld_safe <span class="attribute">--user</span>=mysql &amp;</span><br><span class="line"></span><br><span class="line">启动之后查看错误日志，一般情况下都会相关的错误信息，根据错误信息进行相关排查即可</span><br></pre></td></tr></table></figure>
<h2 id="二、主从复制错误"><a href="#二、主从复制错误" class="headerlink" title="二、主从复制错误"></a>二、主从复制错误</h2><h4 id="2-1、冲突的-server-id"><a href="#2-1、冲突的-server-id" class="headerlink" title="2.1、冲突的 server-id"></a>2.1、冲突的 server-id</h4><blockquote>
<p>Last_IO_Error: Fatal error: The slave I/O thread stops because master and slave have equal MySQL server ids; these ids must be different for replication to work (or the –replicate-same-server-id option must be used on slave but this does not always make sense; please check the manual before using it).</p>
</blockquote>
<p>解决方法：</p>
<p>提示很明显 <code>master</code> 和 <code>slave</code> 有着同样的 <code>server-id</code>，修改成不同的 <code>server-id</code> 即可</p>
<h4 id="2-2、从库读取-binlog-执行-sql-出错"><a href="#2-2、从库读取-binlog-执行-sql-出错" class="headerlink" title="2.2、从库读取 binlog 执行 sql 出错"></a>2.2、从库读取 binlog 执行 sql 出错</h4><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">mysql&gt;</span> <span class="string">show</span> <span class="string">slave</span> <span class="string">status;</span></span><br><span class="line"><span class="string">报错:</span> <span class="string">Error</span> <span class="string">xxx</span> <span class="string">dosn't</span> <span class="string">exist</span></span><br><span class="line"></span><br><span class="line"><span class="string">mysql&gt;</span> <span class="string">show</span> <span class="string">slave</span> <span class="string">status\G:</span></span><br><span class="line"><span class="attr">Slave_IO_Running:</span> <span class="literal">Yes</span></span><br><span class="line"><span class="attr">Slave_SQL_Running:</span> <span class="literal">NO</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Seconds_Behind_Master:</span> <span class="literal">NULL</span></span><br></pre></td></tr></table></figure>
<p>解决方法:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">stop</span> <span class="keyword">slave</span>;</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> sql_slave_skip_counter=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">start</span> <span class="keyword">slave</span>;</span><br></pre></td></tr></table></figure>
<p>这样 Slave 就会和 Master 去同步</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="attribute">Slave_IO_Running</span>:  Yes</span><br><span class="line"><span class="attribute">Slave_SQL_Running</span>: Yes</span><br><span class="line"></span><br><span class="line">Seconds_Behind_Master 此项参数表明 slave 落后 master 的进度。是否为0，0表示已经同步状态。</span><br></pre></td></tr></table></figure>
<p>提示：</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="builtin-name">set</span> global <span class="attribute">sql_slave_skip_counter</span>=n; #n 取值 &gt;0 忽略执行 N 个更新</span><br></pre></td></tr></table></figure>
<h4 id="2-3、同步线程正常，但同步异常"><a href="#2-3、同步线程正常，但同步异常" class="headerlink" title="2.3、同步线程正常，但同步异常"></a>2.3、同步线程正常，但同步异常</h4><blockquote>
<p>转载自 <a href="http://itopic.org/mysql-master-slave-error.html" target="_blank" rel="noopener">http://itopic.org/mysql-master-slave-error.html</a> 老彭的博客</p>
</blockquote>
<p>主从同步异常，先去主库上去查状态。查看主库状态正常，<code>binlog position</code> 一直在变，进程状态也正常</p>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line">mysql&gt; show master status;</span><br><span class="line"><span class="code">+------------------+</span>-----------<span class="code">+--------------+</span>------------------+</span><br><span class="line">| File             | Position  | Binlog<span class="emphasis">_Do_</span>DB | Binlog<span class="emphasis">_Ignore_</span>DB |</span><br><span class="line"><span class="code">+------------------+</span>-----------<span class="code">+--------------+</span>------------------+</span><br><span class="line">| mysql-bin.000364 | 232554068 |              |                  |</span><br><span class="line"><span class="code">+------------------+</span>-----------<span class="code">+--------------+</span>------------------+</span><br><span class="line"></span><br><span class="line">mysql&gt; show processlist;</span><br><span class="line"><span class="code">+-------------+</span>----------<span class="code">+-----------------------------------------------------------------------------+</span></span><br><span class="line">| Command     | Time     | State                                                                       |</span><br><span class="line"><span class="code">+-------------+</span>----------<span class="code">+-----------------------------------------------------------------------------+</span></span><br><span class="line">| Connect     | 14536445 | Slave has read all relay log; waiting for the slave I/O thread to update it |</span><br><span class="line">| Binlog Dump |    22459 | Master has sent all binlog to slave; waiting for binlog to be updated       |</span><br><span class="line"><span class="code">+-------------+</span>----------<span class="code">+-----------------------------------------------------------------------------+</span></span><br></pre></td></tr></table></figure>
<p>接下来查看重库状态，整体上看重库只是有延迟</p>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line">mysql&gt; show slave status\G;</span><br><span class="line"><span class="code"> </span></span><br><span class="line">Master<span class="emphasis">_Log_</span>File: mysql-bin.000364</span><br><span class="line">Read<span class="emphasis">_Master_</span>Log<span class="emphasis">_Pos: 246924389</span></span><br><span class="line"><span class="emphasis">Relay_</span>Log<span class="emphasis">_File: mysql-relay-bin.3831269</span></span><br><span class="line"><span class="emphasis">Relay_</span>Log<span class="emphasis">_Pos: 244389572</span></span><br><span class="line"><span class="emphasis">Relay_</span>Master<span class="emphasis">_Log_</span>File: mysql-bin.000363</span><br><span class="line">Slave<span class="emphasis">_IO_</span>Running: Yes</span><br><span class="line">Slave<span class="emphasis">_SQL_</span>Running: Yes</span><br><span class="line">Seconds<span class="emphasis">_Behind_</span>Master: 23423</span><br><span class="line"></span><br><span class="line">mysql&gt; show processlist;</span><br><span class="line"><span class="code">+---------+</span>-------<span class="code">+-----------------------------------------------------------------------------+</span>------------------+</span><br><span class="line">| Command | Time  | State                                                                       | Info             |</span><br><span class="line"><span class="code">+---------+</span>-------<span class="code">+-----------------------------------------------------------------------------+</span>------------------+</span><br><span class="line">| Connect | 22800 | Waiting for master to send event                                            | NULL             |</span><br><span class="line">| Connect |    99 | Slave has read all relay log; waiting for the slave I/O thread to update it | NULL             |</span><br><span class="line"><span class="code">+---------+</span>-------<span class="code">+-----------------------------------------------------------------------------+</span>------------------+</span><br></pre></td></tr></table></figure>
<p>但等一段时间查看重库却一直不更新，重启后 <code>Seconds_Behind_Master</code> 为 0， <code>Slave_IO_Running</code> 和 <code>Slave_SQL_Running</code> 状态均为 YES。确认了 <code>Master_Host</code>、<code>Master_User</code> 等参数，也匹配了 <code>Master_Server_Id</code> 都是正常的。而后查询 <code>binlog</code></p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">mysqlbinlog mysql-relay-bin.3831269 <span class="attribute">--start-position</span>=244389572 <span class="attribute">--stop-position</span>=246924461 | more</span><br><span class="line">mysqlbinlog mysql-relay-bin.3831269 <span class="attribute">--start-datetime</span>=<span class="string">"2014-08-07 21:30:00"</span> <span class="attribute">--stop-datetime</span>=<span class="string">"2014-08-07 21:35:00"</span> <span class="attribute">--base64-output</span>=decode-rows -v | more</span><br></pre></td></tr></table></figure>
<p>binlog 基于行的复制带上了 <code>--base64-output=decode-rows -v</code> 参数。</p>
<p>慢慢的还真的发现了点东西，发现有执行很多的删除语句，当通过 wc 统计时发现竟然有70多万。在通过业务查看是有执行一条 SQL ，删除表中的所有记录，数据太多，此时查看主从这个表的记录，主库为空，重库记录全在，那可能就是这个原因导致的。该操作可以跳过，于是尝试跳过之：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">mysql&gt;</span><span class="bash">slave stop;</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash">SET GLOBAL SQL_SLAVE_SKIP_COUNTER = 1;</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash">slave start;</span></span><br></pre></td></tr></table></figure>
<p>跳过后 Mysql 恢复正常，最后手动清空重库中该表的数据。至于为什么这个大的删除导致重库停止，还有待深究。</p>
<h4 id="2-4、max-allowed-packet-限制导致主从同步出错"><a href="#2-4、max-allowed-packet-限制导致主从同步出错" class="headerlink" title="2.4、max_allowed_packet 限制导致主从同步出错"></a>2.4、max_allowed_packet 限制导致主从同步出错</h4><blockquote>
<p>摘抄自 <a href="http://itopic.org/mysql-master-slave-error.html" target="_blank" rel="noopener">http://itopic.org/mysql-master-slave-error.html</a> 老彭的博客</p>
</blockquote>
<p>产生的原因也是执行了一个较大的更新，往数据库中更新几十兆的数据（可见更新的不合理），导致主从同步出错，查看重库状态显示</p>
<blockquote>
<p>Last_IO_Error: Got fatal error 1236 from master when reading data from binary log:<br>‘log event entry exceeded max_allowed_packet; Increase max_allowed_packet on master’</p>
</blockquote>
<p>提示修改 max_allowed_packet， 我们就可以看下这个参数的含义</p>
<blockquote>
<p>mysql 服务是通过网络包来传输数据的(通信信息包是指发送至 MySQL 服务器的单个 SQL 语句或发送至客户端的单一行),mysql 协议能够识别的数据包的大小是由max_allowed_packet 控制的。当 MySQL 客户端或 mysqld 服务器收到大于max_allowed_packet 字节的信息包时,将发出 “log event entry exceeded max_allowed_packet;” 错误,并关闭连接。就像此次主从复制遇到的，IO 进程从主库获取日志，但是单个日志中的 sql 大小超过了 max_allowed_packet 的限制，于是报错, IO thread 进程停止，sql thread 显示为 yes。 对于客户端,如果通信信息包过大,在执行查询期间,可能会遇到 “丢失与 MySQL 服务器的连接” 错误。详细参数文档：</p>
</blockquote>
<ul>
<li><a href="http://dev.mysql.com/doc/refman/5.5/en/packet-too-large.html" target="_blank" rel="noopener">http://dev.mysql.com/doc/refman/5.5/en/packet-too-large.html</a></li>
<li><a href="http://dev.mysql.com/doc/refman/5.5/en/server-system-variables.html#sysvar_max_allowed_packet" target="_blank" rel="noopener">http://dev.mysql.com/doc/refman/5.5/en/server-system-variables.html#sysvar_max_allowed_packet</a></li>
</ul>
<p>解决方案就是调整主从 server 上的该参数的值</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 命令行修改临时生效</span></span><br><span class="line">stop slave;</span><br><span class="line"><span class="builtin-name">set</span> global <span class="attribute">max_allowed_packet</span>=1*1024*1024;</span><br><span class="line">start slave;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置文件修改重启生效</span></span><br><span class="line">[mysqld]</span><br><span class="line"><span class="attribute">max_allowed_packet</span>=1*1024*1024</span><br></pre></td></tr></table></figure>
<p>参数的值有一些限制，默认值是 <code>1048576</code>，最小值 <code>1024</code>，最大值 <code>1073741824</code>，并且需要为 <code>1024</code> 的倍数，并且更改 <code>master</code> 这个值最好也需要更改 <code>slave</code> 的值，防止被 <code>client</code> 的配置值覆盖</p>
<h2 id="三、登录错误"><a href="#三、登录错误" class="headerlink" title="三、登录错误"></a>三、登录错误</h2><h4 id="3-1-登录异常"><a href="#3-1-登录异常" class="headerlink" title="3.1 登录异常"></a>3.1 登录异常</h4><blockquote>
<p>mysql&gt; show databases;<br>报错信息如下 “Ignoring query to other database”，做任何操作都一样</p>
</blockquote>
<p>登录输入少了参数 <code>-u</code>，变成了</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">mysql -root -p</span><br><span class="line">变更成 -u root 后恢复正常</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;</p>
<blockquote>
<p>更多阅读</p>
<ul>
<li><a href="https://dev.mysql.com/doc/refman/5.5/en/problems-connecting.html" target="_blank" rel="noopener">Troubleshooting Problems Connecting to MySQL</a></li>
<li><a href="http://dev.mysql.com/doc/refman/5.5/en/innodb-troubleshooting.html" target="_blank" rel="noopener">InnoDB Troubleshooting</a></li>
</ul>
</blockquote>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/note/tags/MySQL-错误集合/" rel="tag"># MySQL 错误集合</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/note/db_MySQL-单机多实例.html" rel="next" title="MySQL 单机多实例">
                <i class="fa fa-chevron-left"></i> MySQL 单机多实例
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/note/db_redis-数据备份.html" rel="prev" title="redis 数据备份">
                redis 数据备份 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
        <!-- JiaThis Button BEGIN -->
<div class="jiathis_style">
<span class="jiathis_txt">分享到：</span>
<a class="jiathis_button_fav">收藏夹</a>
<a class="jiathis_button_copy">复制网址</a>
<a class="jiathis_button_email">邮件</a>
<a class="jiathis_button_weixin">微信</a>
<a class="jiathis_button_qzone">QQ空间</a>
<a class="jiathis_button_tqq">腾讯微博</a>
<a class="jiathis_button_douban">豆瓣</a>
<a class="jiathis_button_share">一键分享</a>

<a href="http://www.jiathis.com/share?uid=2140465" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a>
<a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" >
var jiathis_config={
  data_track_clickback:true,
  summary:"",
  shortUrl:false,
  hideMore:false
}
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=" charset="utf-8"></script>
<!-- JiaThis Button END -->
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="SOHUCS"></div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">宋大明明</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/note/archives">
              
                  <span class="site-state-item-count">78</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/note/categories/index.html">
                  <span class="site-state-item-count">13</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/note/tags/index.html">
                  <span class="site-state-item-count">104</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#一、安装错误"><span class="nav-number">1.</span> <span class="nav-text">一、安装错误</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1、初始化库错误提示"><span class="nav-number">1.0.1.</span> <span class="nav-text">1.1、初始化库错误提示</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2、初始化库错误提示"><span class="nav-number">1.0.2.</span> <span class="nav-text">1.2、初始化库错误提示</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3、mysql-sock-文件查找不到的情况"><span class="nav-number">1.0.3.</span> <span class="nav-text">1.3、mysql.sock 文件查找不到的情况</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#二、主从复制错误"><span class="nav-number">2.</span> <span class="nav-text">二、主从复制错误</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1、冲突的-server-id"><span class="nav-number">2.0.1.</span> <span class="nav-text">2.1、冲突的 server-id</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2、从库读取-binlog-执行-sql-出错"><span class="nav-number">2.0.2.</span> <span class="nav-text">2.2、从库读取 binlog 执行 sql 出错</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3、同步线程正常，但同步异常"><span class="nav-number">2.0.3.</span> <span class="nav-text">2.3、同步线程正常，但同步异常</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-4、max-allowed-packet-限制导致主从同步出错"><span class="nav-number">2.0.4.</span> <span class="nav-text">2.4、max_allowed_packet 限制导致主从同步出错</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#三、登录错误"><span class="nav-number">3.</span> <span class="nav-text">三、登录错误</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-登录异常"><span class="nav-number">3.0.1.</span> <span class="nav-text">3.1 登录异常</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2014 &mdash; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">宋大明明</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/note/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/note/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/note/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/note/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/note/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/note/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/note/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/note/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/note/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/note/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/note/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  




  
    <script type="text/javascript">
    (function(){
      var appid = 'cysXpXYKk';
      var conf = 'prod_5e8c79789369e2fd960db50f54408e02';
      var width = window.innerWidth || document.documentElement.clientWidth;
      if (width < 960) {
      window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id=' + appid + '&conf=' + conf + '"><\/script>'); } else { var loadJs=function(d,a){var c=document.getElementsByTagName("head")[0]||document.head||document.documentElement;var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("charset","UTF-8");b.setAttribute("src",d);if(typeof a==="function"){if(window.attachEvent){b.onreadystatechange=function(){var e=b.readyState;if(e==="loaded"||e==="complete"){b.onreadystatechange=null;a()}}}else{b.onload=a}}c.appendChild(b)};loadJs("https://changyan.sohu.com/upload/changyan.js",function(){
        window.changyan.api.config({appid:appid,conf:conf})});
      }
    })();
    </script>
    <script type="text/javascript" src="https://assets.changyan.sohu.com/upload/plugins/plugins.count.js"></script>
  









  





  

  

  

  
  

  

  

  


</body>
</html>
